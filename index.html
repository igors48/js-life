<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    
    <script src="kinetic-v4.3.3.js"></script>
    <script src="underscore.js"></script>
    
    <script src="assert-base.js"></script>
    <script src="assert.js"></script>
    <script src="coordinates.js"></script>
    <script src="toggle-cell-model.js"></script>
    <script src="kinetic-editor.js"></script>
    <script src="field.js"></script>
    <script src="cell.js"></script>
    <script src="area.js"></script>
    <script src="offset.js"></script>
    <script src="neighbors.js"></script>
    <script src="generation-report.js"></script>
    <script src="viewport.js"></script>

    <script>
        var editor = new KineticEditor('container', 475, 475, 60, 60);
        var mode = 'edit';
        var field;
        
        function buttonClick() {
            
            if (mode === 'edit') {
                var button = document.getElementById('button');
                button.innerHTML = 'Step';
            
                var model = editor.model();
                var cells = model.cells();
                editor.switchToPlayMode();
            
                field = new Field();
            
                var length = cells.length;
            
                for (var i = 0; i < length; ++i) {
                    var current = cells[i];
                
                    field.putLiveCell(current.x(), current.y());
                }
            }    
            
            mode = 'play';
            
            setTimeout(
                function newGeneration() {
                    generation();
                    setTimeout(newGeneration, 100);
                }
            , 100);
        }

        function generation() {
            var generationReport = field.generationNext();
            var dying = generationReport.dyingCells();
            var borning = generationReport.borningCells();
            var living = generationReport.livingCells();
            
            var generationModel = new ToggleCellModel();
            
            _.each(living,
                function (cell) {
                    generationModel.toggle(cell.x(), cell.y());
                }
            );

            _.each(borning,
                function (cell) {
                    generationModel.toggle(cell.x(), cell.y());
                }
            );
            
            editor.replaceModel(generationModel);
        }
        
        function scrollEditorRight() {
            editor.scrollX(-1);
        }

        function scrollEditorLeft() {
            editor.scrollX(1);
        }

        function scrollEditorUp() {
            editor.scrollY(1);
        }

        function scrollEditorDown() {
            editor.scrollY(-1);
        }
        
        function zoomEditorIn() {
            editor.zoom(1);
        }
        
        function zoomEditorOut() {
            editor.zoom(-1);
        }
    </script>
    
    <button id="button" onclick="buttonClick()">Start</button>
    <button id="scrollLeftButton" onclick="scrollEditorLeft();">L</button>
    <button id="scrollRightButton" onclick="scrollEditorRight();">R</button>
    <button id="scrollTopButton" onclick="scrollEditorUp();">U</button>
    <button id="scrollDownButton" onclick="scrollEditorDown();">D</button>
    <button id="zoomInButton" onclick="zoomEditorIn();">Zoom In</button>
    <button id="zoomOutButton" onclick="zoomEditorOut();">Zoom Out</button>
	
	<input type="file" id="files" name="files[]" multiple />
	
  </body>
</html>
